\chapter{نحوه‌ی کار و ارزیابی}\label{chapter4}

\section{نحوه‌ی کار با بستر بدون سرور اینترنت اشیاء}

برای آشنایی با نحوه‌ی کار کردن با بستر بدون سرور اینترنت اشیاء به پیاده‌سازی یک برنامه‌ی کاربردی تست با استفاده از امکانات موجود این بستر می‌پردازیم. این برنامه‌‌ی کاربردی در دو قسمت سرویس دهنده و سرویس گیرنده پیاده‌سازی شده است. همچنین برای ارزیابی بخش مربوط به دستگاه‌های اینترنت اشیاء یک شبیه‌سازی پیاده‌سازی شده است. اصلی‌ترین بخش یک برنامه‌ی کابردی، منطق آن برنامه است که سمت سرور پیاده‌سازی شده و اجرا می‌شود. در این بستر بدون سرور منطق برنامه باید با استفاده از تابع‌ها به عنوان \lr{action} های بستر \lr{OpenWhisk} پیاده‌سازی شود. بنابراین منطق کلی برنامه ابتدا باید تا سطح تابع‌های مجزا بخش شود و سپس نحوه‌ی اتصال این تابع‌ها برای ایجاد آن بخش از منطق برنامه تعیین گردد. برای پیاده‌سازی بخش‌های پیچیده‌ی منطق برنامه، می‌توان از امکانات بستر \lr{OpenWhisk} مانند اتصال تابع‌ها به یکدیگر یا ایجاد \lr{rule} کمک گرفت. در انتها برای ارائه‌ی سرویس به سرویس گیرنده، تابع‌های مورد نظر به عنوان  \lr{REST API} تعریف شده و سرویس گیرنده می‌تواند با ارسال درخواست‌های \lr{HTTP}، به سرویس مورد نیازش دسترسی داشته باشد. شکل زیر مراحل کار با این بستر را نشان می‌دهد.


شکل


برنامه‌ی کاربردی تست در نظر گرفته شده، یک برنامه‌ی کابردی تلفن همراه است که دستگاه‌های متصل به بستر را نمایش می‌دهد و با انتخاب هر دستگاه، داده‌های ارسالی توسط آن دستگاه به صورت بلادرنگ قابل مشاهده خواهد بود.

\subsection{سرویس دهنده}

 \lr{action} هایی که برای این برنامه‌ی کاربردی پیاده‌سازی شده است عبارتند از:

\subsubsection*{\lr{getTelemetryKeys}}

این \lr{action} با گرفتن ‌\lr{token} دستگاه، با اتصال به پایگاه داده‌ی سری زمانی، کلیدهای داده‌هایی که آن دستگاه ارسال کرده است را پیدا کرده و برمی‌گرداند. \lr{token} هر دستگاه یک \lr{string} است که مخصوص همان دستگاه است و با استفاده از آن می‌توان داده‌های ذخیره شده در پایگاه داده سری زمانی را برای هر دستگاه استخراج کرد. برای استخراج این داده‌ها از پایگاه داده باید درخواست موردنظر با زبان درخواست \lr{InfluxDB} نوشته شود و سپس با یک درخواست \lr{HTTP} به پایگاه داده ارسال شود. آدرس پایگاه داده درون خوشه‌ی کوبرنتیز، برابر نام سرویس \lr{ClusterIP} آن پایگاه داده است و \lr{port} آن نیز باید مشخص شود. بقیه‌ی تنظیمات این درخواست \lr{HTTP} باید مطابق با \lr{API} پایگاه داده‌ی \lr{InfluxDB} انجام شود. پایگاه داده نتیجه‌ی درخواست را در جواب برمی‌گرداند. در انتها باید این تنیجه توسط \lr{action} تعریف شده برگردانده شود. این امر به دلیل این که درخواست \lr{HTTP} ناهمگام است به سادگی امکان پذیر نیست، زیرا \lr{action} باید منتظر جواب درخواست \lr{HTTP} بماند و سپس نتیجه را برگرداند. بنابراین از ساختار \lr{promise} زبان \lr{javaScript} استفاده شده است. ساختار \lr{promise} این امکان را می‌دهد که \lr{action} خروجی خود را با تأخیر و به صورت ناهمگام برگرداند.

حال پس از پیاده‌سازی این \lr{action}، نوبت به اجرا می‌رسد. برای اجرا ابتدا باید کتابخانه‌های مورد نیاز این \lr{action} نصب شوند. سپس برای ارزیابی، این تابع با استفاده از توابع دیگر که برای تست نوشته شده‌اند به صورت محلی اجرا می‌شود. در صورت موفقیت آمیز بودن ارزیابی، فایل تابع به همراه کتابخانه‌ها، \lr{zip} شده و با استفاده از اجرای یک دستور در محیط \lr{CLI} مربوط به \lr{OpenWhisk} به نام \lr{wsk}، در بستر آپلود می‌شود. این دستور مورد استفاده در شکل زیر نشان داده شده است.

شکل

\subsubsection*{\lr{getDevices}}

\subsection{سرویس گیرنده}

سرویس گیرنده یک برنامه‌ی کاربردی تلفن همراه است که با استفاده از فریم وورک \lr{React Native} پیاده‌سازی شده است. این برنامه‌ی کابردی باید از \lr{REST API} های تعریف شده توسط سرویس دهنده استفاده کند و دستگاه‌ها و داده‌های مربوط به آن‌ها را نمایش دهد. این برنامه یک واسط کاربری گرافیکی\LTRfootnote{GUI} تلقی شده و تنها برای سهولت درک کارکرد این سیستم طراحی شده است. در ادامه تصاویری از این برنامه نمایش داده شده است.

تصویر

\subsection{دستگاه اینترنت اشیاء}

برای شبیه سازی دستگاه اینترنت اشیاء، یک 

\section{ارزیابی بستر بدون سرور اینترنت اشیاء}



